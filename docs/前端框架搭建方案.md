# å‰ç«¯æ¡†æ¶æ­å»ºæ–¹æ¡ˆ

> åˆ›å»ºæ—¥æœŸï¼š2026-02-13
> åˆ›å»ºäººï¼šæˆå‘˜Cï¼ˆåç«¯+è”è°ƒè´Ÿè´£äººï¼‰
> ç›®çš„ï¼šä¸ºæˆå‘˜Aï¼ˆç§»åŠ¨ç«¯ï¼‰å’Œæˆå‘˜Bï¼ˆPCç«¯ï¼‰æ­å»ºå®Œæ•´çš„å¼€å‘æ¡†æ¶

---

## ğŸ“Š æ­å»ºèƒŒæ™¯

### å½“å‰é¡¹ç›®çŠ¶æ€
| æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| **server/** | âœ… å·²å®Œæˆ | Expressåç«¯ï¼Œ12ä¸ªAPIå…¨éƒ¨å¯ç”¨ |
| **shared/** | âœ… å·²å®Œæˆ | å…±äº«ç±»å‹å®šä¹‰ã€å¸¸é‡é…ç½® |
| **admin/** | âš ï¸ å¾…å®Œå–„ | ä»…æœ‰ViteåŸºç¡€é…ç½® |
| **mini-app/** | âš ï¸ å¾…å®Œå–„ | ä»…æœ‰TaroåŸºç¡€é…ç½® |

### æ­å»ºå†³ç­–
| å†³ç­–é¡¹ | é€‰æ‹© | ç†ç”± |
|--------|------|------|
| **APIæ–¹æ¡ˆ** | çœŸå®APIï¼ˆéMockï¼‰ | åç«¯å·²å®Œæˆï¼Œé¿å…åæœŸæ›¿æ¢å·¥ä½œ |
| **ç§»åŠ¨ç«¯ç»„ä»¶åº“** | NutUI | äº¬ä¸œå‡ºå“ï¼Œç»„ä»¶ä¸°å¯Œï¼Œè®¾è®¡ç°ä»£ |
| **çŠ¶æ€ç®¡ç†** | Zustand | è½»é‡çº§ï¼Œå­¦ä¹ æ›²çº¿å¹³ç¼“ |
| **HTTPå®¢æˆ·ç«¯** | axios (PC) / Taro.request (ç§»åŠ¨) | ç¬¦åˆæŠ€æœ¯æ ˆæœ€ä½³å®è·µ |

---

## ğŸ¯ æ­å»ºç›®æ ‡

### æˆå‘˜B - PCç«¯ (admin/)

```
æŠ€æœ¯æ ˆï¼šReact + Vite + TypeScript + Ant Design + Zustand + axios
ç«¯å£ï¼šlocalhost:5173
ç›®æ ‡ï¼šå¼€ç®±å³ç”¨ï¼Œcloneå npm install å³å¯å¼€å‘
```

**é¡µé¢æ¸…å•**ï¼š
1. ç™»å½•/æ³¨å†Œé¡µ (`/login`, `/register`)
2. é…’åº—å½•å…¥é¡µ (`/hotel/edit`, `/hotel/edit/:id`)
3. å®¡æ ¸åˆ—è¡¨é¡µ (`/audit`)
4. ä¸»å¸ƒå±€æ¡†æ¶

### æˆå‘˜A - ç§»åŠ¨ç«¯ (mini-app/)

```
æŠ€æœ¯æ ˆï¼šTaro + React + TypeScript + NutUI + Zustand + Taro.request
ç«¯å£ï¼šlocalhost:10086 (H5)
ç›®æ ‡ï¼šå¼€ç®±å³ç”¨ï¼Œæ”¯æŒH5å’Œå°ç¨‹åºåŒç«¯å‘å¸ƒ
```

**é¡µé¢æ¸…å•**ï¼š
1. é¦–é¡µ/æŸ¥è¯¢é¡µ (`/pages/home`)
2. é…’åº—åˆ—è¡¨é¡µ (`/pages/list`)
3. é…’åº—è¯¦æƒ…é¡µ (`/pages/detail`)

---

## ğŸ“ admin/ ç›®å½•ç»“æ„

```
admin/
â”œâ”€â”€ public/
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ assets/                  # é™æ€èµ„æº
â”‚   â”‚   â””â”€â”€ images/
â”‚   â”œâ”€â”€ components/              # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ PageHeader/         # é¡µé¢å¤´éƒ¨
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ ImageUpload/        # å›¾ç‰‡ä¸Šä¼ ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â””â”€â”€ RoomTypeEditor/     # æˆ¿å‹ç¼–è¾‘ç»„ä»¶
â”‚   â”‚       â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ pages/                  # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ Login/              # ç™»å½•/æ³¨å†Œé¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx
â”‚   â”‚   â”‚   â””â”€â”€ RegisterForm.tsx
â”‚   â”‚   â”œâ”€â”€ HotelEdit/          # é…’åº—å½•å…¥é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â””â”€â”€ HotelForm.tsx
â”‚   â”‚   â”œâ”€â”€ AuditList/          # å®¡æ ¸åˆ—è¡¨é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â””â”€â”€ AuditTable.tsx
â”‚   â”‚   â””â”€â”€ Layout/             # ä¸»å¸ƒå±€
â”‚   â”‚       â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ services/               # APIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ request.ts          # axioså°è£…
â”‚   â”‚   â”œâ”€â”€ api.ts             # çœŸå®APIè°ƒç”¨
â”‚   â”‚   â””â”€â”€ types.ts           # APIç±»å‹ï¼ˆå¼•ç”¨sharedï¼‰
â”‚   â”œâ”€â”€ store/                 # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯çŠ¶æ€
â”‚   â”‚   â””â”€â”€ index.ts          # Storeå¯¼å‡º
â”‚   â”œâ”€â”€ hooks/                 # è‡ªå®šä¹‰hooks
â”‚   â”‚   â””â”€â”€ useAuth.ts        # è®¤è¯Hook
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ router/                # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ styles/                # å…¨å±€æ ·å¼
â”‚   â”‚   â””â”€â”€ global.css
â”‚   â”œâ”€â”€ App.tsx               # åº”ç”¨æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.tsx              # åº”ç”¨å…¥å£
â”œâ”€â”€ .env                      # ç¯å¢ƒå˜é‡
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tsconfig.node.json
â””â”€â”€ vite.config.ts
```

---

## ğŸ“ mini-app/ ç›®å½•ç»“æ„

```
mini-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/              # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ HotelCard/         # é…’åº—å¡ç‰‡
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ SearchBar/         # æœç´¢æ 
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ FilterBar/         # ç­›é€‰æ 
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ ImageSwiper/       # å›¾ç‰‡è½®æ’­
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â””â”€â”€ Skeleton/          # éª¨æ¶å±
â”‚   â”‚       â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ pages/                 # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ home/              # é¦–é¡µ/æŸ¥è¯¢é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚   â”‚       â”œâ”€â”€ SearchForm.tsx
â”‚   â”‚   â”‚       â””â”€â”€ HotRecommend.tsx
â”‚   â”‚   â”œâ”€â”€ list/              # åˆ—è¡¨é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚   â”‚       â”œâ”€â”€ HotelList.tsx
â”‚   â”‚   â”‚       â””â”€â”€ FilterBar.tsx
â”‚   â”‚   â””â”€â”€ detail/            # è¯¦æƒ…é¡µ
â”‚   â”‚       â”œâ”€â”€ index.tsx
â”‚   â”‚       â””â”€â”€ components/
â”‚   â”‚           â”œâ”€â”€ ImageSwiper.tsx
â”‚   â”‚           â”œâ”€â”€ RoomList.tsx
â”‚   â”‚           â””â”€â”€ BookButton.tsx
â”‚   â”œâ”€â”€ services/              # APIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ request.ts        # Taro.requestå°è£…
â”‚   â”‚   â”œâ”€â”€ api.ts           # çœŸå®APIè°ƒç”¨
â”‚   â”‚   â””â”€â”€ types.ts        # APIç±»å‹ï¼ˆå¼•ç”¨sharedï¼‰
â”‚   â”œâ”€â”€ store/                # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ hotel.ts         # é…’åº—çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ location.ts      # å®šä½çŠ¶æ€
â”‚   â”‚   â””â”€â”€ index.ts        # Storeå¯¼å‡º
â”‚   â”œâ”€â”€ hooks/                # è‡ªå®šä¹‰hooks
â”‚   â”‚   â”œâ”€â”€ useLocation.ts   # LBSå®šä½Hook
â”‚   â”‚   â””â”€â”€ useRequest.ts   # è¯·æ±‚Hook
â”‚   â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ date.ts         # æ—¥æœŸå¤„ç†
â”‚   â”‚   â””â”€â”€ distance.ts     # è·ç¦»è®¡ç®—
â”‚   â”œâ”€â”€ styles/               # å…¨å±€æ ·å¼
â”‚   â”‚   â””â”€â”€ app.scss
â”‚   â”œâ”€â”€ app.config.ts         # Taroåº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ app.tsx              # åº”ç”¨æ ¹ç»„ä»¶
â”‚   â””â”€â”€ app.scss
â”œâ”€â”€ project.h5.json          # H5ç«¯é…ç½®
â”œâ”€â”€ project.weapp.json       # å°ç¨‹åºç«¯é…ç½®
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ config/
    â””â”€â”€ index.ts
```

---

## ğŸ”§ APIæœåŠ¡å®ç°æ–¹æ¡ˆ

### admin/src/services/request.ts

```typescript
import axios, { AxiosInstance, AxiosError, InternalAxiosRequestConfig } from 'axios';
import { message } from 'antd';

// åˆ›å»ºaxioså®ä¾‹
const request: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:3000/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// è¯·æ±‚æ‹¦æˆªå™¨ï¼šæ·»åŠ token
request.interceptors.request.use(
  (config: InternalAxiosRequestConfig) => {
    const token = localStorage.getItem('token');
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// å“åº”æ‹¦æˆªå™¨ï¼šç»Ÿä¸€å¤„ç†é”™è¯¯
request.interceptors.response.use(
  (response) => {
    const { data } = response;
    if (data.success === false) {
      message.error(data.message || 'è¯·æ±‚å¤±è´¥');
      return Promise.reject(new Error(data.message || 'è¯·æ±‚å¤±è´¥'));
    }
    return data;
  },
  (error: AxiosError) => {
    if (error.response?.status === 401) {
      message.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
      localStorage.removeItem('token');
      window.location.href = '/login';
    } else if (error.response?.status === 403) {
      message.error('æ²¡æœ‰æƒé™è®¿é—®');
    } else {
      message.error(error.message || 'ç½‘ç»œé”™è¯¯');
    }
    return Promise.reject(error);
  }
);

export default request;
```

### admin/src/services/api.ts

```typescript
import request from './request';
import type {
  LoginRequest,
  LoginResponse,
  RegisterRequest,
  Hotel,
  CreateHotelRequest,
  UpdateHotelRequest,
  HotelQueryParams,
  HotelListResponse,
} from '../../../../shared/types';

// ==================== è®¤è¯API ====================

/**
 * POST /api/auth/login
 * ç”¨æˆ·ç™»å½•
 */
export const loginApi = (data: LoginRequest) =>
  request.post<LoginResponse>('/auth/login', data);

/**
 * POST /api/auth/register
 * ç”¨æˆ·æ³¨å†Œ
 */
export const registerApi = (data: RegisterRequest) =>
  request.post<LoginResponse>('/auth/register', data);

/**
 * GET /api/auth/me
 * è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
 */
export const getCurrentUserApi = () =>
  request.get('/auth/me');

/**
 * POST /api/auth/change-password
 * ä¿®æ”¹å¯†ç 
 */
export const changePasswordApi = (data: { oldPassword: string; newPassword: string }) =>
  request.post('/auth/change-password', data);

// ==================== é…’åº—API ====================

/**
 * GET /api/hotels
 * è·å–é…’åº—åˆ—è¡¨
 */
export const getHotelsApi = (params?: HotelQueryParams) =>
  request.get<HotelListResponse>('/hotels', { params });

/**
 * GET /api/hotels/:id
 * è·å–é…’åº—è¯¦æƒ…
 */
export const getHotelDetailApi = (id: string) =>
  request.get<{ success: true; data: Hotel }>(`/hotels/${id}`);

/**
 * POST /api/hotels
 * åˆ›å»ºé…’åº—
 */
export const createHotelApi = (data: CreateHotelRequest) =>
  request.post<{ success: true; data: Hotel }>('/hotels', data);

/**
 * PUT /api/hotels/:id
 * æ›´æ–°é…’åº—
 */
export const updateHotelApi = (id: string, data: UpdateHotelRequest) =>
  request.put<{ success: true; data: Hotel }>(`/hotels/${id}`, data);

/**
 * DELETE /api/hotels/:id
 * åˆ é™¤é…’åº—
 */
export const deleteHotelApi = (id: string) =>
  request.delete(`/hotels/${id}`);

/**
 * POST /api/hotels/:id/audit
 * å®¡æ ¸é…’åº—
 */
export const auditHotelApi = (id: string, action: 'approve' | 'reject') =>
  request.post(`/hotels/${id}/audit`, { action });

/**
 * POST /api/hotels/:id/status
 * æ›´æ–°é…’åº—çŠ¶æ€
 */
export const updateHotelStatusApi = (id: string, status: 'online' | 'offline') =>
  request.post(`/hotels/${id}/status`, { status });

/**
 * GET /api/hotels/nearby
 * è·å–é™„è¿‘é…’åº—
 */
export const getNearbyHotelsApi = (params: {
  lat: number;
  lng: number;
  radius: number;
}) =>
  request.get<HotelListResponse>('/hotels/nearby', { params });
```

---

## ğŸ“¦ package.json ä¾èµ–é…ç½®

### admin/package.json

```json
{
  "name": "admin",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext ts,tsx"
  },
  "dependencies": {
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.22.0",
    "antd": "^5.13.0",
    "axios": "^1.6.7",
    "zustand": "^4.5.0",
    "dayjs": "^1.11.10"
  },
  "devDependencies": {
    "@types/react": "^18.3.0",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react": "^4.2.1",
    "typescript": "^5.4.0",
    "vite": "^5.1.0",
    "eslint": "^8.57.0"
  }
}
```

### mini-app/package.json

```json
{
  "name": "mini-app",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev:h5": "npm run build:h5 -- --watch",
    "dev:weapp": "npm run build:weapp -- --watch",
    "build:h5": "taro build --type h5",
    "build:weapp": "taro build --type weapp"
  },
  "dependencies": {
    "@tarojs/components": "^3.6.24",
    "@tarojs/helper": "^3.6.24",
    "@tarojs/plugin-framework-react": "^3.6.24",
    "@tarojs/plugin-platform-h5": "^3.6.24",
    "@tarojs/plugin-platform-weapp": "^3.6.24",
    "@tarojs/react": "^3.6.24",
    "@tarojs/runtime": "^3.6.24",
    "@tarojs/taro": "^3.6.24",
    "@nutui/nutui-react-taro": "^2.0.0",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "axios": "^1.6.7",
    "zustand": "^4.5.0",
    "dayjs": "^1.11.10"
  },
  "devDependencies": {
    "@types/react": "^18.3.0",
    "@tarojs/cli": "^3.6.24",
    "@tarojs/webpack5-runner": "^3.6.24",
    "typescript": "^5.4.0",
    "webpack": "^5.90.0"
  }
}
```

---

## ğŸŒ ç¯å¢ƒå˜é‡é…ç½®

### admin/.env

```bash
# APIåœ°å€
VITE_API_BASE_URL=http://localhost:3000/api

# åº”ç”¨æ ‡é¢˜
VITE_APP_TITLE=æ˜“å®¿é…’åº—ç®¡ç†å¹³å°
```

### mini-app/.env (æš‚ä¸æ”¯æŒï¼Œä½¿ç”¨config)

---

## ğŸ”„ çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ

### admin/src/store/auth.ts

```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import type { SafeUser } from '../../../shared/types';

interface AuthState {
  user: SafeUser | null;
  token: string | null;
  isAuthenticated: boolean;
  setAuth: (user: SafeUser, token: string) => void;
  clearAuth: () => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      token: null,
      isAuthenticated: false,
      setAuth: (user, token) =>
        set({ user, token, isAuthenticated: true }),
      clearAuth: () =>
        set({ user: null, token: null, isAuthenticated: false }),
    }),
    {
      name: 'auth-storage',
    }
  )
);
```

---

## ğŸš€ å¯åŠ¨å‘½ä»¤

### æ ¹ç›®å½• package.json æ›´æ–°

```json
{
  "name": "Trip",
  "scripts": {
    "dev": "concurrently \"pnpm --filter server dev\" \"pnpm --filter admin dev\"",
    "dev:all": "concurrently \"pnpm --filter server dev\" \"pnpm --filter admin dev\" \"pnpm --filter mini-app dev:h5\"",
    "dev:server": "pnpm --filter server dev",
    "dev:admin": "pnpm --filter admin dev",
    "dev:mobile": "pnpm --filter mini-app dev:h5"
  },
  "devDependencies": {
    "concurrently": "^8.2.2"
  }
}
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### admin/ éªŒæ”¶æ¸…å•
- [ ] `npm run dev` èƒ½æ­£å¸¸å¯åŠ¨ (localhost:5173)
- [ ] èƒ½è°ƒç”¨åç«¯ç™»å½•APIæˆåŠŸ
- [ ] ZustandçŠ¶æ€å­˜å‚¨æ­£å¸¸å·¥ä½œ
- [ ] è·¯ç”±å®ˆå«æ­£å¸¸è·³è½¬
- [ ] é¡µé¢æ¡†æ¶å¯å±•ç¤º

### mini-app/ éªŒæ”¶æ¸…å•
- [ ] `npm run dev:h5` èƒ½æ­£å¸¸å¯åŠ¨ (localhost:10086)
- [ ] NutUIç»„ä»¶æ­£å¸¸æ˜¾ç¤º
- [ ] èƒ½è°ƒç”¨åç«¯APIè·å–é…’åº—åˆ—è¡¨
- [ ] é¡µé¢è·¯ç”±æ­£å¸¸å·¥ä½œ

---

## ğŸ“ ç»™å‰ç«¯åŒå­¦çš„ä½¿ç”¨è¯´æ˜

### å…‹éš†é¡¹ç›®å

```bash
# 1. è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd Trip

# 2. å®‰è£…æ‰€æœ‰ä¾èµ–
pnpm install

# 3. å¯åŠ¨å¼€å‘ç¯å¢ƒ
# æˆå‘˜B (PCç«¯)
pnpm dev:admin

# æˆå‘˜A (ç§»åŠ¨ç«¯)
pnpm dev:mobile
```

### APIè°ƒç”¨ç¤ºä¾‹

```typescript
// PCç«¯
import { loginApi, getHotelsApi } from '@/services/api';

// ç™»å½•
const result = await loginApi({ username: 'admin', password: 'admin123' });

// è·å–é…’åº—åˆ—è¡¨
const hotels = await getHotelsApi({ page: 1, pageSize: 10 });
```

---

> æ–¹æ¡ˆç‰ˆæœ¬ï¼šv1.0
> åˆ›å»ºæ—¶é—´ï¼š2026-02-13
> çŠ¶æ€ï¼šå¾…å®æ–½
