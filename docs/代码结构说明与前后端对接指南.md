# ä»£ç ç»“æ„è¯´æ˜ä¸å‰åç«¯å¯¹æ¥æŒ‡å—

> æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜é¡¹ç›®ä»£ç ç»“æ„ï¼Œé‡ç‚¹è®²è§£å‰åç«¯å¯¹æ¥æ–¹å¼

---

## ğŸ“ æ•´ä½“ç›®å½•ç»“æ„

```
Trip/                              # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ shared/                          # ã€æ ¸å¿ƒã€‘å‰åç«¯å…±äº«ä»£ç 
â”‚   â”œâ”€â”€ types/                        # ç±»å‹å®šä¹‰ï¼ˆå‰åç«¯å…±ç”¨ï¼‰
â”‚   â”œâ”€â”€ constants/                    # é€šç”¨é…ç½®
â”‚   â””â”€â”€ components/Calendar/          # å…±äº«ç»„ä»¶ï¼ˆæ—¥å†ï¼‰
â”‚
â”œâ”€â”€ server/                          # åç«¯ï¼ˆæˆå‘˜Cè´Ÿè´£ï¼‰
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ routes/                    # APIè·¯ç”±å±‚
â”‚       â”œâ”€â”€ controllers/               # æ§åˆ¶å™¨å±‚
â”‚       â”œâ”€â”€ services/                  # ä¸šåŠ¡é€»è¾‘å±‚
â”‚       â”œâ”€â”€ middleware/                # ä¸­é—´ä»¶
â”‚       â””â”€â”€ data/                     # JSONæ•°æ®å­˜å‚¨
â”‚
â”œâ”€â”€ admin/                           # PCç®¡ç†ç«¯ï¼ˆæˆå‘˜Bè´Ÿè´£ï¼‰
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ store/                     # ZustandçŠ¶æ€ç®¡ç†
â”‚       â”œâ”€â”€ services/                  # APIè°ƒç”¨ï¼ˆMock/çœŸå®ï¼‰
â”‚       â””â”€â”€ pages/                    # é¡µé¢ç»„ä»¶
â”‚
â”œâ”€â”€ mini-app/                        # ç§»åŠ¨ç«¯ï¼ˆæˆå‘˜Aè´Ÿè´£ï¼‰
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ store/                     # ZustandçŠ¶æ€ç®¡ç†
â”‚       â”œâ”€â”€ services/                  # APIè°ƒç”¨ï¼ˆMock/çœŸå®ï¼‰
â”‚       â”œâ”€â”€ components/                # å…¬å…±ç»„ä»¶
â”‚       â””â”€â”€ pages/                    # é¡µé¢ç»„ä»¶
â”‚
â””â”€â”€ README.md                        # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

---

## ğŸ”„ å‰åç«¯å¯¹æ¥æ ¸å¿ƒæœºåˆ¶

### ä¸€ã€ç±»å‹å…±äº«æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    shared/types/ - ç±»å‹å®šä¹‰ä¸­å¿ƒ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  hotel.ts          room.ts          user.ts          api.ts        â”‚
â”‚    â†“                 â†“                 â†“                â†“            â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                        â†“                                       â”‚
â”‚                shared/types/index.ts                        â”‚
â”‚                   ï¼ˆç»Ÿä¸€å¯¼å‡ºï¼‰                                â”‚
â”‚                        â†“                                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚         â”‚  å‰ç«¯å¼•ç”¨è·¯å¾„      â”‚                            â”‚
â”‚         â†“                    â†“                            â”‚
â”‚  admin/src/      mini-app/src/                              â”‚
â”‚  services/types.ts  services/types.ts                              â”‚
â”‚         â†“                    â†“                            â”‚
â”‚    ä» @shared/types/* å¯¼å…¥                              â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¤ºä¾‹ä»£ç **ï¼š

```typescript
// åç«¯ä½¿ç”¨ç±»å‹ï¼ˆserver/src/controllers/hotels.tsï¼‰
import type { Hotel, CreateHotelRequest, HotelQueryParams } from '../../../shared/types/hotel';

// PCç«¯ä½¿ç”¨ç±»å‹ï¼ˆadmin/src/pages/HotelEdit/index.tsxï¼‰
import type { CreateHotelRequest } from '@shared/types/hotel';

// ç§»åŠ¨ç«¯ä½¿ç”¨ç±»å‹ï¼ˆmini-app/src/pages/home/index.tsxï¼‰
import type { HotelQueryParams } from '@shared/types/hotel';
```

---

### äºŒã€APIæ¥å£å¯¹æ¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APIæ¥å£è°ƒç”¨æµç¨‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  å‰ç«¯ï¼ˆadmin/mini-appï¼‰                                      â”‚
â”‚       â”‚                                                        â”‚
â”‚       â”œâ”€â”€ services/api.ts          â†â”€â”€â”€â”€â”€â†’  çœŸå®APIè°ƒç”¨              â”‚
â”‚       â”‚    â†“                                                   â”‚
â”‚       â”‚   axios/request                                      â”‚
â”‚       â”‚    â†“                                                   â”‚
â”‚       â””â”€â”€ http://localhost:3000/api/*  â†â”€â”€â†’  åç«¯Express          â”‚
â”‚                                                               â”‚
â”‚  åç«¯ï¼ˆserverï¼‰                                                â”‚
â”‚       â”‚                                                        â”‚
â”‚       â”œâ”€â”€ src/routes/               â†â”€â”€â”€ æ¥æ”¶è¯·æ±‚                â”‚
â”‚       â”‚    â†“                                                   â”‚
â”‚       â”œâ”€â”€ src/controllers/        â†â”€â”€â”€ å¤„ç†ä¸šåŠ¡é€»è¾‘              â”‚
â”‚       â”‚    â†“                                                   â”‚
â”‚       â”œâ”€â”€ src/services/            â†â”€â”€â”€ æ•°æ®æ“ä½œ                    â”‚
â”‚       â”‚    â†“                                                   â”‚
â”‚       â””â”€â”€ src/data/*.json         â†â”€â”€â”€ è¿”å›æ•°æ®                  â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®å¯¹æ¥ç‚¹**ï¼š

| å¯¹æ¥ç‚¹ | åç«¯å®ç°ä½ç½® | å‰ç«¯ä½¿ç”¨ä½ç½® | è¯´æ˜ |
|--------|-------------|-------------|------|
| **ç™»å½•API** | `server/src/routes/auth.ts` | `admin/src/pages/Login/index.tsx` | POST /api/auth/login |
| **é…’åº—åˆ—è¡¨** | `server/src/routes/hotels.ts` | `mini-app/src/pages/list/index.tsx` | GET /api/hotels |
| **é…’åº—è¯¦æƒ…** | `server/src/routes/hotels.ts` | `mini-app/src/pages/detail/index.tsx` | GET /api/hotels/:id |
| **LBSå®šä½** | `server/src/routes/hotels.ts` | `mini-app/src/hooks/useLocation.ts` | GET /api/hotels/nearby |
| **åˆ›å»ºé…’åº—** | `server/src/routes/hotels.ts` | `admin/src/pages/HotelEdit/index.tsx` | POST /api/hotels |
| **å®¡æ ¸é…’åº—** | `server/src/routes/hotels.ts` | `admin/src/pages/AuditList/index.tsx` | POST /api/hotels/:id/audit |

---

### ä¸‰ã€Mockæ¨¡å¼åˆ‡æ¢æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Day 1-3: Mockæ¨¡å¼ï¼ˆå‰ç«¯ç‹¬ç«‹å¼€å‘ï¼‰                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  admin/src/services/          mini-app/src/services/                â”‚
â”‚       â”‚                               â”‚                        â”‚
â”‚   mockApi.ts  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   mockApi.ts                      â”‚
â”‚       â”‚                               â”‚                        â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ¨¡æ‹Ÿæ•°æ®ï¼ˆå‡æ•°æ®ï¼‰                           â”‚
â”‚                   âœ… æ— éœ€åç«¯ï¼Œå‰ç«¯ç‹¬ç«‹å¼€å‘                       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Day 4èµ·: çœŸå®APIæ¨¡å¼ï¼ˆå‰åç«¯è”è°ƒï¼‰                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  admin/src/services/          mini-app/src/services/                â”‚
â”‚       â”‚                               â”‚                        â”‚
â”‚   api.ts  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   api.ts                             â”‚
â”‚       â”‚                               â”‚                        â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ çœŸå®HTTPè¯·æ±‚                            â”‚
â”‚                   âœ… è°ƒç”¨åç«¯Express API                       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ‡æ¢æ–¹æ³•**ï¼ˆä»…ä¿®æ”¹ä¸€è¡Œä»£ç ï¼‰ï¼š

```typescript
// âŒ Mockæ¨¡å¼ï¼ˆDay 1-3ï¼‰
import { loginApi, getHotelListApi } from './services/mockApi';

// âœ… çœŸå®APIæ¨¡å¼ï¼ˆDay 4èµ·ï¼‰
import { loginApi, getHotelListApi } from './services/api';
```

**æ¯ä¸ªå‰ç«¯é¡¹ç›®éƒ½æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶**ï¼š

| é¡¹ç›® | Mockæ–‡ä»¶ | çœŸå®APIæ–‡ä»¶ | åˆ‡æ¢ä½ç½® |
|-----|----------|-------------|---------|
| PCç®¡ç†ç«¯ | `admin/src/services/mockApi.ts` | `admin/src/services/api.ts` | Login, HotelEdit, AuditList |
| ç§»åŠ¨ç«¯ | `mini-app/src/services/mockApi.ts` | `mini-app/src/services/api.ts` | home, list, detail |

---

## ğŸ“¦ è¯¦ç»†ç›®å½•è¯´æ˜

### 1. shared/ - å‰åç«¯å…±äº«ä»£ç 

```
shared/
â”œâ”€â”€ types/                        # ã€é‡è¦ã€‘ç±»å‹å®šä¹‰ï¼Œå‰åç«¯å¿…é¡»ä¿æŒä¸€è‡´
â”‚   â”œâ”€â”€ hotel.ts              # é…’åº—ç±»å‹ï¼ˆHotel, HotelQueryParamsç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ Hotel              # é…’åº—æ•°æ®ç»“æ„
â”‚   â”‚   â”œâ”€â”€ HotelQueryParams   # åˆ—è¡¨æŸ¥è¯¢å‚æ•°
â”‚   â”‚   â”œâ”€â”€ CreateHotelRequest # åˆ›å»ºé…’åº—è¯·æ±‚
â”‚   â”‚   â””â”€â”€ HotelListResponse # åˆ—è¡¨å“åº”
â”‚   â”‚
â”‚   â”œâ”€â”€ room.ts               # æˆ¿å‹ç±»å‹
â”‚   â”‚   â”œâ”€â”€ RoomType          # æˆ¿å‹æ•°æ®ç»“æ„
â”‚   â”‚   â””â”€â”€ BookingRequest    # é¢„è®¢è¯·æ±‚
â”‚   â”‚
â”‚   â”œâ”€â”€ user.ts               # ç”¨æˆ·ç±»å‹
â”‚   â”‚   â”œâ”€â”€ User              # ç”¨æˆ·æ•°æ®ç»“æ„
â”‚   â”‚   â”œâ”€â”€ LoginRequest      # ç™»å½•è¯·æ±‚
â”‚   â”‚   â””â”€â”€ LoginResponse     # ç™»å½•å“åº”
â”‚   â”‚
â”‚   â”œâ”€â”€ api.ts                # APIé€šç”¨ç±»å‹
â”‚   â”‚   â”œâ”€â”€ ApiSuccess        # æˆåŠŸå“åº” { success: true, data: T }
â”‚   â”‚   â”œâ”€â”€ ApiError          # é”™è¯¯å“åº” { success: false, message: string }
â”‚   â”‚   â””â”€â”€ ApiResponse      # è”åˆç±»å‹
â”‚   â”‚
â”‚   â””â”€â”€ index.ts             # ç»Ÿä¸€å¯¼å‡ºï¼ˆexport * from './...'ï¼‰
â”‚
â”œâ”€â”€ constants/
â”‚   â””â”€â”€ config.ts             # é€šç”¨é…ç½®
â”‚       â”œâ”€â”€ API_CONFIG         # API_BASE_URL, TIMEOUT
â”‚       â”œâ”€â”€ APP_CONFIG         # åº”ç”¨é…ç½®
â”‚       â”œâ”€â”€ ERROR_CODES        # é”™è¯¯ç å®šä¹‰
â”‚       â””â”€â”€ HOTEL_STATUS      # é…’åº—çŠ¶æ€æšä¸¾
â”‚
â””â”€â”€ components/Calendar/       # å…±äº«æ—¥å†ç»„ä»¶ï¼ˆå‰åç«¯é€šç”¨ï¼‰
    â”œâ”€â”€ index.tsx             # ä¸»ç»„ä»¶
    â”œâ”€â”€ DatePanel.tsx         # æ—¥æœŸé¢æ¿
    â”œâ”€â”€ types.ts             # ç»„ä»¶ç±»å‹
    â””â”€â”€ index.scss           # ç»„ä»¶æ ·å¼
```

---

### 2. server/ - åç«¯Expressæ¡†æ¶

```
server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts               # ã€å…¥å£ã€‘ExpressæœåŠ¡å™¨å¯åŠ¨
â”‚   â”‚   â””â”€â”€ app.listen(3000)  # ç›‘å¬ç«¯å£
â”‚   â”‚
â”‚   â”œâ”€â”€ app.ts                # ã€é…ç½®ã€‘Expressåº”ç”¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ helmet()          # å®‰å…¨ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ cors()            # è·¨åŸŸé…ç½®ï¼ˆå…è®¸localhost:5173,10086ï¼‰
â”‚   â”‚   â”œâ”€â”€ express.json()     # JSONè§£æ
â”‚   â”‚   â””â”€â”€ routes           # æŒ‚è½½è·¯ç”±
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/               # ã€è·¯ç”±å±‚ã€‘APIç«¯ç‚¹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ index.ts          # è·¯ç”±æ±‡æ€»
â”‚   â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ POST /api/auth/register
â”‚   â”‚   â”‚   â”œâ”€â”€ POST /api/auth/login
â”‚   â”‚   â”‚   â”œâ”€â”€ GET  /api/auth/me
â”‚   â”‚   â”‚   â””â”€â”€ POST /api/auth/change-password
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ hotels.ts         # é…’åº—è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ GET    /api/hotels           # åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€ç­›é€‰ã€æ’åºï¼‰
â”‚   â”‚       â”œâ”€â”€ GET    /api/hotels/nearby     # é™„è¿‘é…’åº—ï¼ˆLBSï¼‰
â”‚   â”‚       â”œâ”€â”€ GET    /api/hotels/:id         # è¯¦æƒ…
â”‚   â”‚       â”œâ”€â”€ POST   /api/hotels             # åˆ›å»º
â”‚   â”‚       â”œâ”€â”€ PUT    /api/hotels/:id         # æ›´æ–°
â”‚   â”‚       â”œâ”€â”€ POST   /api/hotels/:id/audit   # å®¡æ ¸
â”‚   â”‚       â”œâ”€â”€ POST   /api/hotels/:id/status # ä¸Šçº¿/ä¸‹çº¿
â”‚   â”‚       â””â”€â”€ DELETE /api/hotels/:id         # åˆ é™¤
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/           # ã€æ§åˆ¶å™¨å±‚ã€‘å¤„ç†HTTPè¯·æ±‚
â”‚   â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ register()   # å¤„ç†æ³¨å†Œè¯·æ±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ login()      # å¤„ç†ç™»å½•è¯·æ±‚ï¼Œç”ŸæˆJWT token
â”‚   â”‚   â”‚   â”œâ”€â”€ me()         # è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
â”‚   â”‚   â”‚   â””â”€â”€ changePassword()  # ä¿®æ”¹å¯†ç 
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ hotels.ts         # é…’åº—æ§åˆ¶å™¨
â”‚   â”‚       â”œâ”€â”€ getList()        # è·å–åˆ—è¡¨ï¼ˆå¤„ç†åˆ†é¡µã€ç­›é€‰ã€æ’åºï¼‰
â”‚   â”‚       â”œâ”€â”€ getNearby()     # è·å–é™„è¿‘é…’åº—ï¼ˆLBSï¼‰
â”‚   â”‚       â”œâ”€â”€ getDetail()      # è·å–è¯¦æƒ…
â”‚   â”‚       â”œâ”€â”€ create()        # åˆ›å»ºé…’åº—
â”‚   â”‚       â”œâ”€â”€ update()        # æ›´æ–°é…’åº—
â”‚   â”‚       â”œâ”€â”€ audit()         # å®¡æ ¸é…’åº—
â”‚   â”‚       â””â”€â”€ delete()        # åˆ é™¤é…’åº—
â”‚   â”‚
â”‚   â”œâ”€â”€ services/             # ã€ä¸šåŠ¡é€»è¾‘å±‚ã€‘æ•°æ®å¤„ç†
â”‚   â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ findByUsername()  # æŸ¥æ‰¾ç”¨æˆ·
â”‚   â”‚   â”‚   â”œâ”€â”€ findById()         # æ ¹æ®IDæŸ¥æ‰¾ç”¨æˆ·
â”‚   â”‚   â”‚   â”œâ”€â”€ create()           # åˆ›å»ºç”¨æˆ·ï¼ˆå¯†ç åŠ å¯†ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ update()           # æ›´æ–°ç”¨æˆ·
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ hotels.ts         # é…’åº—æœåŠ¡
â”‚   â”‚       â”œâ”€â”€ readHotels()       # è¯»å–JSONæ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ writeHotels()      # å†™å…¥JSONæ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ getList()         # è·å–åˆ—è¡¨ï¼ˆå¤„ç†ç­›é€‰ã€æ’åºï¼‰
â”‚   â”‚       â”œâ”€â”€ getById()         # æ ¹æ®IDè·å–
â”‚   â”‚       â”œâ”€â”€ create()           # åˆ›å»ºï¼ˆç”ŸæˆIDï¼‰
â”‚   â”‚       â”œâ”€â”€ update()           # æ›´æ–°
â”‚   â”‚       â””â”€â”€ delete()           # åˆ é™¤
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/            # ã€ä¸­é—´ä»¶ã€‘è¯·æ±‚/å“åº”å¤„ç†
â”‚   â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯ä¸­é—´ä»¶ï¼ˆéªŒè¯JWT tokenï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ authenticate()  # ä»Authorization headerè·å–token
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ cors.ts           # è·¨åŸŸä¸­é—´ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ å…è®¸localhost:5173, 10086
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ error.ts          # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â”‚   â”‚       â””â”€â”€ errorHandler()  # ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ errors.ts        # è‡ªå®šä¹‰é”™è¯¯ç±»
â”‚   â”‚       â”œâ”€â”€ ApiError
â”‚   â”‚       â”œâ”€â”€ ValidationError
â”‚   â”‚       â””â”€â”€ NotFoundError
â”‚   â”‚
â”‚   â””â”€â”€ data/                 # ã€æ•°æ®å­˜å‚¨ã€‘JSONæ–‡ä»¶
â”‚       â”œâ”€â”€ users.json         # ç”¨æˆ·æ•°æ®ï¼ˆåˆå§‹æœ‰adminè´¦å·ï¼‰
â”‚       â”œâ”€â”€ hotels.json        # é…’åº—æ•°æ®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚       â””â”€â”€ .gitkeep          # ä¿æŒç›®å½•åœ¨Gitä¸­
â”‚
â”œâ”€â”€ package.json               # ä¾èµ–ï¼šexpress, cors, helmet, jsonwebtoken, bcrypt
â””â”€â”€ tsconfig.json
```

---

### 3. admin/ - PCç®¡ç†ç«¯

```
admin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx               # ã€å…¥å£ã€‘Reactåº”ç”¨å…¥å£
â”‚   â”‚   â””â”€â”€ ReactDOM.createRoot(<App />)  # æŒ‚è½½æ ¹ç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ App.tsx                # æ ¹ç»„ä»¶
â”‚   â”‚   â””â”€â”€ <Layout><Outlet /></Layout>
â”‚   â”‚
â”‚   â”œâ”€â”€ router.tsx             # ã€è·¯ç”±ã€‘React Routeré…ç½®
â”‚   â”‚   â”œâ”€â”€ /login            # Loginé¡µé¢
â”‚   â”‚   â””â”€â”€ /                # LayoutåŒ…è£¹çš„å­è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ /hotels/edit    # HotelEdité¡µé¢
â”‚   â”‚       â””â”€â”€ /hotels/audit   # AuditListé¡µé¢
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                 # ã€çŠ¶æ€ã€‘ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ useAuthStore.ts    # è®¤è¯çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ user, token, isAuthenticated
â”‚   â”‚   â”‚   â””â”€â”€ setAuth(), logout()
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ useHotelStore.ts   # é…’åº—ç®¡ç†çŠ¶æ€
â”‚   â”‚       â”œâ”€â”€ hotels[], total, loading
â”‚   â”‚       â””â”€â”€ setHotels(), addHotel(), updateHotel()
â”‚   â”‚
â”‚   â”œâ”€â”€ services/              # ã€APIè°ƒç”¨ã€‘å‰åç«¯å¯¹æ¥ç‚¹
â”‚   â”‚   â”œâ”€â”€ mockApi.ts        # Day 1-3ä½¿ç”¨
â”‚   â”‚   â”‚   â””â”€â”€ loginApi(), getHotelListApi() è¿”å›æ¨¡æ‹Ÿæ•°æ®
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api.ts            # Day 4èµ·ä½¿ç”¨
â”‚   â”‚   â”‚   â”œâ”€â”€ apiClient     # axioså®ä¾‹é…ç½®ï¼ˆbaseURL: localhost:3000ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ è¯·æ±‚/å“åº”æ‹¦æˆªå™¨ï¼ˆè‡ªåŠ¨æ·»åŠ tokenï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ loginApi(), getHotelListApi() è°ƒç”¨çœŸå®API
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ types.ts        # ä»@shared/typeså¯¼å‡º
â”‚   â”‚
â”‚   â”œâ”€â”€ components/Layout/      # ã€å¸ƒå±€ã€‘ç®¡ç†åå°å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ index.tsx         # ä¾§è¾¹æ èœå• + å¤´éƒ¨
â”‚   â”‚   â””â”€â”€ index.scss
â”‚   â”‚
â”‚   â””â”€â”€ pages/                # ã€é¡µé¢ã€‘ä¸‰ä¸ªæ ¸å¿ƒé¡µé¢
â”‚       â”œâ”€â”€ Login/            # ç™»å½•/æ³¨å†Œé¡µ
â”‚       â”‚   â”œâ”€â”€ index.tsx     # ç™»å½•è¡¨å•
â”‚       â”‚   â”‚   â””â”€â”€ è°ƒç”¨ loginApiï¼ˆæ¥è‡ªservices/mockApi.tsæˆ–api.tsï¼‰
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ index.scss
â”‚       â”‚
â”‚       â”œâ”€â”€ HotelEdit/         # é…’åº—ä¿¡æ¯å½•å…¥é¡µ
â”‚       â”‚   â”œâ”€â”€ index.tsx     # é…’åº—åˆ—è¡¨ + æ–°å¢/ç¼–è¾‘å¼¹çª—
â”‚       â”‚   â”‚   â””â”€â”€ è°ƒç”¨ getHotelListApi, createHotelApi, updateHotelApi
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ index.scss
â”‚       â”‚
â”‚       â””â”€â”€ AuditList/         # å®¡æ ¸åˆ—è¡¨é¡µ
â”‚           â”œâ”€â”€ index.tsx     # å¾…å®¡æ ¸/å·²é€šè¿‡/å·²æ‹’ç»/å·²ä¸‹çº¿æ ‡ç­¾é¡µ
â”‚           â”‚   â””â”€â”€ è°ƒç”¨ getHotelListApi, auditHotelApi, updateHotelStatusApi
â”‚           â”‚
â”‚           â””â”€â”€ index.scss
â”‚
â”œâ”€â”€ index.html                # HTMLæ¨¡æ¿
â”œâ”€â”€ vite.config.ts            # Viteé…ç½®ï¼ˆä»£ç†/apiåˆ°localhost:3000ï¼‰
â””â”€â”€ package.json
```

---

### 4. mini-app/ - ç§»åŠ¨ç«¯

```
mini-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.tsx                # ã€å…¥å£ã€‘Taroåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ app.config.ts           # ã€é…ç½®ã€‘Taroåº”ç”¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ pages[]           # é¡µé¢æ³¨å†Œ
â”‚   â”‚   â””â”€â”€ tabBar          # åº•éƒ¨æ ‡ç­¾æ 
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                 # ã€çŠ¶æ€ã€‘ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ useHotelStore.ts  # é…’åº—æœç´¢çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ searchParamsï¼ˆå…³é”®è¯ã€æ—¥æœŸã€å®šä½ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ setSearchParams()
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ useLocationStore.ts  # å®šä½çŠ¶æ€
â”‚   â”‚       â”œâ”€â”€ location, loading, error
â”‚   â”‚       â””â”€â”€ setLocation(), getLocation()
â”‚   â”‚
â”‚   â”œâ”€â”€ services/              # ã€APIè°ƒç”¨ã€‘å‰åç«¯å¯¹æ¥ç‚¹
â”‚   â”‚   â”œâ”€â”€ mockApi.ts        # Day 1-3ä½¿ç”¨
â”‚   â”‚   â”‚   â”œâ”€â”€ searchHotelsApi()  # è¿”å›æ¨¡æ‹Ÿé…’åº—æ•°æ®
â”‚   â”‚   â”‚   â”œâ”€â”€ getHotelDetailApi() # è¿”å›æ¨¡æ‹Ÿè¯¦æƒ…æ•°æ®
â”‚   â”‚   â”‚   â””â”€â”€ getLocationApi()    # æ¨¡æ‹ŸLBSå®šä½
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api.ts            # Day 4èµ·ä½¿ç”¨
â”‚   â”‚   â”‚   â”œâ”€â”€ Taro.requestå°è£…
â”‚   â”‚   â”‚   â”œâ”€â”€ searchHotelsApi()    # è°ƒç”¨GET /api/hotels
â”‚   â”‚   â”‚   â”œâ”€â”€ getHotelDetailApi()  # è°ƒç”¨GET /api/hotels/:id
â”‚   â”‚   â”‚   â””â”€â”€ getLocationApi()      # è·å–å®šä½åè°ƒç”¨GET /api/hotels/nearby
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ types.ts        # ä»@shared/typeså¯¼å‡º
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                 # ã€è‡ªå®šä¹‰Hooksã€‘
â”‚   â”‚   â”œâ”€â”€ useLocation.ts     # å®šä½Hookï¼ˆè°ƒç”¨getLocationApiï¼‰
â”‚   â”‚   â”œâ”€â”€ useVirtualList.ts # è™šæ‹Ÿæ»šåŠ¨Hookï¼ˆDay 8-9å®ç°ï¼‰
â”‚   â”‚   â””â”€â”€ useRequest.ts     # è¯·æ±‚Hookï¼ˆå°è£…loadingçŠ¶æ€ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ components/            # ã€å…¬å…±ç»„ä»¶ã€‘
â”‚   â”‚   â”œâ”€â”€ HotelCard/        # é…’åº—å¡ç‰‡ï¼ˆä½¿ç”¨@shared/components/Calendarï¼‰
â”‚   â”‚   â”œâ”€â”€ FilterBar/        # ç­›é€‰æ ï¼ˆä»·æ ¼ã€è·ç¦»ã€è¯„åˆ†æ’åºï¼‰
â”‚   â”‚   â””â”€â”€ Skeleton/         # éª¨æ¶å±ï¼ˆåŠ è½½å ä½ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                # ã€é¡µé¢ã€‘ä¸‰ä¸ªæ ¸å¿ƒé¡µé¢
â”‚   â”‚   â”œâ”€â”€ home/            # é¦–é¡µ/æŸ¥è¯¢é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx     # æœç´¢è¡¨å• + çƒ­é—¨æ¨è
â”‚   â”‚   â”‚   â”œâ”€â”€ ä½¿ç”¨ useLocationStoreï¼ˆå®šä½ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ä½¿ç”¨ useHotelStoreï¼ˆæœç´¢å‚æ•°ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ è°ƒç”¨ searchHotelsApi, getLocationApi
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ list/            # åˆ—è¡¨é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx     # é…’åº—åˆ—è¡¨ + ç­›é€‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ä½¿ç”¨ HotelCard ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ä½¿ç”¨ FilterBar ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ä¸‹æ‹‰åˆ·æ–° + ä¸Šæ‹‰åŠ è½½æ›´å¤š
â”‚   â”‚   â”‚   â””â”€â”€ è°ƒç”¨ searchHotelsApi
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ detail/          # è¯¦æƒ…é¡µ
â”‚   â”‚       â”œâ”€â”€ index.tsx     # å›¾ç‰‡è½®æ’­ + æˆ¿å‹åˆ—è¡¨
â”‚   â”‚       â”œâ”€â”€ ä½¿ç”¨ @shared/components/Calendar
â”‚   â”‚       â””â”€â”€ è°ƒç”¨ getHotelDetailApi
â”‚   â”‚
â”‚   â””â”€â”€ utils/                # ã€å·¥å…·å‡½æ•°ã€‘
â”‚       â”œâ”€â”€ date.ts           # æ—¥æœŸå¤„ç†ï¼ˆDay.jsï¼‰
â”‚       â”‚   â”œâ”€â”€ calculateNights()  # è®¡ç®—é—´å¤œ
â”‚       â”‚   â””â”€â”€ isValidDateRange()  # æ£€æŸ¥æ—¥æœŸèŒƒå›´
â”‚       â”‚
â”‚       â””â”€â”€ distance.ts       # è·ç¦»è®¡ç®—
â”‚           â”œâ”€â”€ calculateDistance()  # Haversineå…¬å¼
â”‚           â””â”€â”€ formatDistance()      # æ ¼å¼åŒ–æ˜¾ç¤º
â”‚
â”œâ”€â”€ config/index.ts            # Taroé…ç½®ï¼ˆåˆ«å@ã€@sharedè·¯å¾„ï¼‰
â”œâ”€â”€ project.h5.json           # H5ç«¯é…ç½®
â”œâ”€â”€ project.weapp.json        # å°ç¨‹åºç«¯é…ç½®
â””â”€â”€ package.json
```

---

## ğŸ”Œ å‰åç«¯å¯¹æ¥è¯¦ç»†è¯´æ˜

### æ­¥éª¤1ï¼šç±»å‹å®šä¹‰ä¸€è‡´æ€§

**åŸåˆ™**ï¼šå‰åç«¯ä½¿ç”¨ç›¸åŒçš„ç±»å‹å®šä¹‰ï¼Œç¡®ä¿æ¥å£å¥‘çº¦ä¸€è‡´ã€‚

```
åç«¯å®šä¹‰                â†’  shared/types/       â†’  å‰ç«¯ä½¿ç”¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Hotelæ¥å£            â†’  hotel.ts            â†’  admin/mini-app
LoginRequestæ¥å£     â†’  user.ts             â†’  è°ƒç”¨æ—¶è·å¾—ç±»å‹æç¤º
ApiResponseè”åˆç±»å‹   â†’  api.ts              â†’  ç»Ÿä¸€å“åº”æ ¼å¼
```

**ç¤ºä¾‹**ï¼š

```typescript
// åç«¯ï¼ˆserver/src/controllers/hotels.tsï¼‰
import type { CreateHotelRequest, Hotel } from '../../../shared/types/hotel';

export const hotelController = {
  create: async (req: Request, res: Response) => {
    const body: CreateHotelRequest = req.body;  // âœ… ç±»å‹å®‰å…¨
    const newHotel: Hotel = await hotelService.create(body, createdBy);
    res.json({ success: true, data: newHotel });  // âœ… å“åº”æ ¼å¼ä¸€è‡´
  },
};

// PCç«¯ï¼ˆadmin/src/pages/HotelEdit/index.tsxï¼‰
import type { CreateHotelRequest } from '@shared/types/hotel';

const handleSubmit = async () => {
  const values: CreateHotelRequest = await form.validateFields();  // âœ… ç±»å‹æç¤º
  const response = await createHotelApi(values);
  if (response.success) {  // âœ… å“åº”ç±»å‹åˆ¤æ–­
    // ...
  }
};
```

---

### æ­¥éª¤2ï¼šAPIå“åº”æ ¼å¼ç»Ÿä¸€

**ç»Ÿä¸€å“åº”æ ¼å¼**ï¼ˆåœ¨ `shared/types/api.ts` å®šä¹‰ï¼‰ï¼š

```typescript
// æˆåŠŸå“åº”
interface ApiSuccess<T> {
  success: true;
  data: T;
  message?: string;
}

// é”™è¯¯å“åº”
interface ApiError {
  success: false;
  message: string;
  code?: string;
}

// è”åˆç±»å‹
type ApiResponse<T> = ApiSuccess<T> | ApiError;
```

**åç«¯è¿”å›**ï¼ˆæ‰€æœ‰æ¥å£å¿…é¡»éµå¾ªï¼‰ï¼š

```typescript
// server/src/controllers/hotels.ts
res.json({
  success: true,      // âœ… å¿…é¡»æœ‰
  data: hotel,        // âœ… æˆåŠŸæ—¶æœ‰data
  message: 'æ“ä½œæˆåŠŸ' // å¯é€‰
});

// é”™è¯¯æ—¶
res.status(400).json({
  success: false,      // âœ… é”™è¯¯æ—¶successä¸ºfalse
  message: 'å‚æ•°é”™è¯¯', // âœ… å¿…é¡»æœ‰message
  code: 'INVALID_PARAMS' // å¯é€‰
});
```

**å‰ç«¯æ¥æ”¶**ï¼ˆç»Ÿä¸€å¤„ç†ï¼‰ï¼š

```typescript
// admin/src/services/api.ts æˆ– mini-app/src/services/api.ts
const response = await apiClient.post('/api/hotels', data);

if (response.success) {  // âœ… ç±»å‹å®‰å…¨åˆ¤æ–­
  const hotel = response.data;  // âœ… dataå­˜åœ¨ä¸”æœ‰ç±»å‹
  // å¤„ç†æˆåŠŸ
} else {
  const errorMsg = response.message;  // âœ… messageå­˜åœ¨
  // å¤„ç†é”™è¯¯
}
```

---

### æ­¥éª¤3ï¼šCORSè·¨åŸŸé…ç½®

**åç«¯é…ç½®**ï¼ˆ`server/src/app.ts`ï¼‰ï¼š

```typescript
import cors from 'cors';

app.use(
  cors({
    // âœ… å¿…é¡»é…ç½®ï¼Œå¦åˆ™å‰ç«¯æ— æ³•è°ƒç”¨
    origin: ['http://localhost:5173',  // PCç®¡ç†ç«¯
             'http://localhost:10086'], // ç§»åŠ¨ç«¯H5
    credentials: true,  // å…è®¸æºå¸¦cookie
  })
);
```

**å‰ç«¯é…ç½®**ï¼ˆVite/Taro proxyï¼‰ï¼š

```typescript
// admin/vite.config.ts - PCç«¯ä»£ç†
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:3000',  // âœ… ä»£ç†åˆ°åç«¯
        changeOrigin: true,
      },
    },
  },
});

// mini-app/config/index.ts - ç§»åŠ¨ç«¯Taroé…ç½®
h5: {
  webpackChain(chain) {
    // âœ… Taroä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œå¼€å‘æ—¶é€šè¿‡devServerå¤„ç†
  }
}
```

---

### æ­¥éª¤4ï¼šè®¤è¯Tokenæœºåˆ¶

**åç«¯JWTç”Ÿæˆ**ï¼ˆ`server/src/controllers/auth.ts`ï¼‰ï¼š

```typescript
import jwt from 'jsonwebtoken';

const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';
const JWT_EXPIRES_IN = '7d';

function generateToken(userId: string): string {
  return jwt.sign({ userId }, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN });
}

// ç™»å½•æˆåŠŸè¿”å›token
const token = generateToken(user.id);
res.json({
  success: true,
  data: {
    token,  // âœ… å‰ç«¯éœ€è¦ä¿å­˜æ­¤token
    user: safeUser,
  },
});
```

**å‰ç«¯Tokenä½¿ç”¨**ï¼ˆ`admin/src/services/api.ts`ï¼‰ï¼š

```typescript
// âœ… è¯·æ±‚æ‹¦æˆªå™¨è‡ªåŠ¨æ·»åŠ token
apiClient.interceptors.request.use(config => {
  const token = localStorage.getItem('auth-storage');  // Zustand persistå­˜å‚¨
  if (token) {
    const auth = JSON.parse(token);
    if (auth.state.token) {
      config.headers.Authorization = `Bearer ${auth.state.token}`;  // âœ… Beareræ ¼å¼
    }
  }
  return config;
});

// âœ… PCç«¯ZustandæŒä¹…åŒ–å­˜å‚¨
export const useAuthStore = create<AuthState>()(
  persist(
    set => ({
      token: null,
      setAuth: (user, token) => set({ user, token, isAuthenticated: true }),
    }),
    { name: 'auth-storage' }  // âœ… å­˜å‚¨åˆ°localStorage
  )
);
```

**åç«¯TokenéªŒè¯**ï¼ˆ`server/src/middleware/auth.ts`ï¼‰ï¼š

```typescript
import jwt from 'jsonwebtoken';

export const authenticate = (req: Request, res: Response, next: NextFunction) => {
  const authHeader = req.headers.authorization;  // âœ… è·å–Authorization header

  if (!authHeader || !authHeader.startsWith('Bearer ')) {
    return res.status(401).json({
      success: false,
      message: 'æœªæä¾›è®¤è¯Token',
    });
  }

  const token = authHeader.substring(7);  // ç§»é™¤ "Bearer " å‰ç¼€
  const decoded = jwt.verify(token, JWT_SECRET) as { userId: string };

  req.userId = decoded.userId;  // âœ… é™„åŠ åˆ°è¯·æ±‚å¯¹è±¡
  next();
};

// è·¯ç”±ä½¿ç”¨ä¿æŠ¤
router.post('/', authenticate, hotelController.create);  // âœ… éœ€è¦è®¤è¯
```

---

### æ­¥éª¤5ï¼šMockæ¨¡å¼åˆ‡æ¢ï¼ˆDay 1-3 vs Day 4+ï¼‰

**é˜¶æ®µå¯¹æ¯”**ï¼š

| é¡¹ç›® | Day 1-3ï¼ˆMockæ¨¡å¼ï¼‰ | Day 4+ï¼ˆçœŸå®APIï¼‰ |
|-----|---------------------|------------------|
| **APIæ–‡ä»¶** | `services/mockApi.ts` | `services/api.ts` |
| **æ•°æ®æ¥æº** | å†…å­˜ä¸­å®šä¹‰çš„å‡æ•°æ® | Expressåç«¯HTTPè¯·æ±‚ |
| **ç½‘ç»œè¯·æ±‚** | `await delay(300)` æ¨¡æ‹Ÿå»¶è¿Ÿ | `axios.request()` çœŸå®HTTP |
| **åç«¯ä¾èµ–** | âŒ ä¸éœ€è¦åç«¯è¿è¡Œ | âœ… å¿…é¡»å¯åŠ¨åç«¯æœåŠ¡ |
| **é”™è¯¯å¤„ç†** | ç®€å•è¿”å› `{ success: false }` | axiosæ‹¦æˆªå™¨å¤„ç†ç½‘ç»œé”™è¯¯ |

**åˆ‡æ¢æ—¶æœº**ï¼ˆDay 4ï¼‰ï¼š

```typescript
// ========== å‰ç½®æ¡ä»¶ ==========
// âœ… åç«¯å·²å¯åŠ¨ï¼ˆcd server && npm run devï¼‰
// âœ… åç«¯APIå¯ç”¨ï¼ˆcurl http://localhost:3000/api/healthï¼‰

// ========== åˆ‡æ¢æ­¥éª¤ ==========
// 1. PCç®¡ç†ç«¯
// admin/src/pages/Login/index.tsx
// admin/src/pages/HotelEdit/index.tsx
// admin/src/pages/AuditList/index.tsx
- import { loginApi, getHotelListApi } from './services/mockApi';
+ import { loginApi, getHotelListApi } from './services/api';

// 2. ç§»åŠ¨ç«¯
// mini-app/src/pages/home/index.tsx
// mini-app/src/pages/list/index.tsx
// mini-app/src/pages/detail/index.tsx
- import { searchHotelsApi, getHotelDetailApi } from '../../services/mockApi';
+ import { searchHotelsApi, getHotelDetailApi } from '../../services/api';
```

---

## ğŸ“Š APIæ¥å£å®Œæ•´åˆ—è¡¨

### è®¤è¯ç›¸å…³

| æ–¹æ³• | è·¯å¾„ | è¯·æ±‚ä½“ | å“åº” | ä½¿ç”¨ä½ç½® |
|-----|------|--------|--------|---------|
| POST | `/api/auth/register` | `{ username, password, realName, role }` | `{ success, data: { token, user } }` | PCç«¯æ³¨å†Œ |
| POST | `/api/auth/login` | `{ username, password }` | `{ success, data: { token, user } }` | PCç«¯ç™»å½• |
| GET | `/api/auth/me` | Header: `Authorization: Bearer {token}` | `{ success, data: user }` | è·å–å½“å‰ç”¨æˆ· |
| POST | `/api/auth/change-password` | `{ oldPassword, newPassword }` | `{ success, message }` | ä¿®æ”¹å¯†ç  |

### é…’åº—ç›¸å…³

| æ–¹æ³• | è·¯å¾„ | æŸ¥è¯¢å‚æ•° | å“åº” | ä½¿ç”¨ä½ç½® |
|-----|------|---------|--------|---------|
| GET | `/api/hotels` | `keyword, city, checkIn, checkOut, minPrice, maxPrice, sortBy, page, pageSize` | `{ success, data: hotels[], total, hasMore }` | ç§»åŠ¨ç«¯åˆ—è¡¨ |
| GET | `/api/hotels/nearby` | `lat, lng, radius, page, pageSize` | `{ success, data: hotels[] }` | LBSé™„è¿‘é…’åº— |
| GET | `/api/hotels/:id` | - | `{ success, data: hotel }` | è¯¦æƒ…é¡µ |
| POST | `/api/hotels` | `Hotelå¯¹è±¡ï¼ˆCreateHotelRequestï¼‰` | `{ success, data: hotel }` | PCç«¯åˆ›å»º |
| PUT | `/api/hotels/:id` | `Hotelå¯¹è±¡ï¼ˆUpdateHotelRequestï¼‰` | `{ success, data: hotel }` | PCç«¯æ›´æ–° |
| POST | `/api/hotels/:id/audit` | `{ action: 'approve'\|'reject', reason? }` | `{ success, message }` | PCç«¯å®¡æ ¸ |
| POST | `/api/hotels/:id/status` | `{ status: 'online'\|'offline' }` | `{ success, message }` | PCç«¯ä¸Šä¸‹çº¿ |
| DELETE | `/api/hotels/:id` | - | `{ success, message }` | PCç«¯åˆ é™¤ |

### å¥åº·æ£€æŸ¥

| æ–¹æ³• | è·¯å¾„ | å“åº” |
|-----|------|------|
| GET | `/api/health` | `{ success: true, message: 'Server is running' }` |

---

## ğŸ”§ å¼€å‘è°ƒè¯•æŠ€å·§

### åç«¯è°ƒè¯•

```bash
# å¯åŠ¨åç«¯
cd server
npm run dev

# æµ‹è¯•API
curl http://localhost:3000/api/health

# æµ‹è¯•ç™»å½•
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"password123"}'
```

### PCç«¯è°ƒè¯•

```bash
# å¯åŠ¨PCç«¯
cd admin
npm run dev

# æµè§ˆå™¨è®¿é—®
http://localhost:5173

# å¼€å‘è€…å·¥å…·æ£€æŸ¥
# - Networkæ ‡ç­¾æŸ¥çœ‹/apiè¯·æ±‚
# - Application -> Local Storage æŸ¥çœ‹auth-storage
# - Console æŸ¥çœ‹é”™è¯¯æ—¥å¿—
```

### ç§»åŠ¨ç«¯è°ƒè¯•

```bash
# å¯åŠ¨H5
cd mini-app
npm run dev:h5

# æµè§ˆå™¨è®¿é—®
http://localhost:10086

# å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼ˆå¦‚éœ€å°ç¨‹åºï¼‰
# -> æ‰“å¼€é¡¹ç›® -> mini-app/dist/
```

---

## âš ï¸ å¸¸è§å¯¹æ¥é—®é¢˜

### é—®é¢˜1ï¼šCORSè·¨åŸŸé”™è¯¯

**ç°è±¡**ï¼šå‰ç«¯æ§åˆ¶å°æ˜¾ç¤º `Access to XMLHttpRequest has been blocked by CORS policy`

**è§£å†³**ï¼š
```typescript
// æ£€æŸ¥ server/src/app.ts
app.use(cors({
  origin: ['http://localhost:5173', 'http://localhost:10086'],
  credentials: true,
}));
```

---

### é—®é¢˜2ï¼šç±»å‹ä¸åŒ¹é…

**ç°è±¡**ï¼š`TypeScript error: Property 'xxx' does not exist on type 'yyy'`

**è§£å†³**ï¼š
```bash
# ç¡®ä¿shared/typesç±»å‹å®šä¹‰å®Œæ•´
cd shared/types
git add .
git commit -m "feat: ç»Ÿä¸€ç±»å‹å®šä¹‰"

# å‰ç«¯é‡æ–°å®‰è£…ç±»å‹
cd admin
npm install
```

---

### é—®é¢˜3ï¼šTokenæœªä¼ é€’

**ç°è±¡**ï¼šåç«¯è¿”å› `401 Unauthorized`ï¼Œä½†å‰ç«¯å·²ç™»å½•

**è§£å†³**ï¼š
```typescript
// æ£€æŸ¥å‰ç«¯è¯·æ±‚æ‹¦æˆªå™¨
// admin/src/services/api.ts æˆ– mini-app/src/services/api.ts
apiClient.interceptors.request.use(config => {
  console.log('Request headers:', config.headers);  // è°ƒè¯•è¾“å‡º
  // ç¡®ä¿Authorizationæ ¼å¼æ­£ç¡®ï¼šBearer {token}
  return config;
});
```

---

### é—®é¢˜4ï¼šMockæ¨¡å¼åˆ‡æ¢åä»è¿”å›æ—§æ•°æ®

**ç°è±¡**ï¼šåˆ‡æ¢åˆ°çœŸå®APIåï¼Œæ•°æ®è¿˜æ˜¯Mockçš„å‡æ•°æ®

**è§£å†³**ï¼š
```bash
# 1. ç¡®è®¤å·²ä¿®æ”¹importè¯­å¥
grep -r "from './services/mockApi'" admin/src/pages
# åº”è¯¥è¾“å‡ºç©ºæˆ–åªæœ‰æ³¨é‡Š

# 2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
# å¼€å‘è€…å·¥å…· -> Application -> Clear site data

# 3. é‡å¯å¼€å‘æœåŠ¡å™¨
cd admin && npm run dev
```

---

## ğŸ“… Day 4è”è°ƒæ£€æŸ¥æ¸…å•

### åç«¯æ£€æŸ¥ï¼ˆæˆå‘˜Cï¼‰

- [ ] ExpressæœåŠ¡æ­£å¸¸è¿è¡Œï¼ˆ`http://localhost:3000`ï¼‰
- [ ] `/api/health` ç«¯ç‚¹è¿”å› `{ success: true }`
- [ ] ç”¨æˆ·æ•°æ®æ–‡ä»¶å­˜åœ¨ï¼ˆ`server/src/data/users.json`ï¼‰
- [ ] CORSé…ç½®æ­£ç¡®ï¼ˆå…è®¸localhost:5173å’Œ10086ï¼‰

### PCç«¯æ£€æŸ¥ï¼ˆæˆå‘˜Bï¼‰

- [ ] å·²å°† `Login/index.tsx` ä¸­çš„importæ”¹ä¸º `./services/api`
- [ ] å·²å°† `HotelEdit/index.tsx` ä¸­çš„importæ”¹ä¸º `./services/api`
- [ ] å·²å°† `AuditList/index.tsx` ä¸­çš„importæ”¹ä¸º `./services/api`
- [ ] Viteä»£ç†é…ç½®æ­£å¸¸ï¼ˆ`vite.config.ts`ï¼‰
- [ ] èƒ½æˆåŠŸç™»å½•å¹¶è·å–token

### ç§»åŠ¨ç«¯æ£€æŸ¥ï¼ˆæˆå‘˜Aï¼‰

- [ ] å·²å°† `home/index.tsx` ä¸­çš„importæ”¹ä¸º `../../services/api`
- [ ] å·²å°† `list/index.tsx` ä¸­çš„importæ”¹ä¸º `../../services/api`
- [ ] å·²å°† `detail/index.tsx` ä¸­çš„importæ”¹ä¸º `../../services/api`
- [ ] Taroé…ç½®è·¯å¾„åˆ«åæ­£ç¡®ï¼ˆ`config/index.ts`ï¼‰
- [ ] èƒ½æˆåŠŸè°ƒç”¨é…’åº—åˆ—è¡¨API

---

> æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0
> åˆ›å»ºæ—¥æœŸï¼š2025-02-13
> ç»´æŠ¤è€…ï¼šå›¢é˜Ÿæˆå‘˜Cï¼ˆåç«¯+è”è°ƒè´Ÿè´£äººï¼‰
